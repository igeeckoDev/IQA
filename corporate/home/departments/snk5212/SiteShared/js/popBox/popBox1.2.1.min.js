(function ($) { $.fn.popBox = function (options) { var defaults = { height: 100, width: 300, newlineString: "<br/>" }; var options = $.extend(defaults, options); return this.each(function () { obj = $(this); var inputName = 'popBoxInput' + obj.attr("Id"); var labelValue = $("label[for=" + obj.attr('id') + "]").text(); obj.after('<div class="popBox-holder"></div><div class="popBox-container"><label style="display: none;" for="' + inputName + '">' + labelValue + '</label> <textarea id="' + inputName + '" name="' + inputName + '" class="popBox-input" /><div class="done-button"><input type="button" value="Done" class="button blue small"/></div></div>'); obj.focus(function () { $(this).next(".popBox-holder").show(); var popBoxContainer = $(this).next().next(".popBox-container"); var change = true; popBoxContainer.children('.popBox-input').css({ height: options.height, width: options.width }); popBoxContainer.show(); var scrolled = $(document).scrollTop(); var top = ($(window).height() - popBoxContainer.outerHeight()) / 2 + scrolled; var left = ($(window).width() - popBoxContainer.outerWidth()) / 2; $(".popBox-holder").css({ top: scrolled }); popBoxContainer.css({ position: 'fixed', margin: 0, top: (top > 0 ? top : 0) + 'px', left: (left > 0 ? left : 0) + 'px' }); popBoxContainer.children('.popBox-input').val($(this).val().replace(RegExp(options.newlineString, "g"), "\n")); popBoxContainer.children('.popBox-input').focus(); popBoxContainer.children().keydown(function (e) { if (e == null) { keycode = event.keyCode } else { keycode = e.which } if (keycode == 27) { $(this).parent().hide(); $(this).parent().prev().hide(); change = false } }); popBoxContainer.children().blur(function () { if (change) { $(this).parent().hide(); $(this).parent().prev().hide(); $(this).parent().prev().prev().val($(this).val().replace(/\n/g, options.newlineString)) } }) }) }) } })(jQuery);